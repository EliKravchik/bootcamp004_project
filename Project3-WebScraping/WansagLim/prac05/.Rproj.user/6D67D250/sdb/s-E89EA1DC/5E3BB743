{
    "contents" : "library(shiny)\nlibrary(DT)\nlibrary(jsonlite)\nlibrary(ggplot2)\n\nshinyServer(function(input, output, session) {\n  \n  articleSearch <- reactive(input$text)\n    # eventReactive(input$goButton,{ input$text}) \n  \n  year10 <- reactive(input$year)\n    # eventReactive(input$yearButton,{input$year} )\n  \n  yearInterest <- reactive(input$yearInterest)\n  yearMonth <- reactive(input$yearMonth)\n  monthInterest <- reactive(input$monthInterest)\n  pageInput <- reactive(input$pageInput)\n  addressInput <- reactive(input$typeAdd)\n\n  #renderPrint, renderPlot\n  output$graphHit <-renderPlot({\n    input$goButton\n    isolate({\n      articleSearch <- articleSearch()\n      year10 <- year10()\n      year09 <- year10() - 1\n      year08 <- year10() - 2\n      year07 <- year10() - 3\n      year06 <- year10() - 4\n      year05 <- year10() - 5\n      year04 <- year10() - 6\n      year03 <- year10() - 7\n      year02 <- year10() - 8\n      year01 <- year10() - 9\n      year00 <- year10() - 10\n      \n      year10 <- paste(year10, \"0217\", sep = \"\") \n      year09 <- paste(year09, \"0217\", sep = \"\") \n      year08 <- paste(year08, \"0217\", sep = \"\") \n      year07 <- paste(year07, \"0217\", sep = \"\") \n      year06 <- paste(year06, \"0217\", sep = \"\") \n      year05 <- paste(year05, \"0217\", sep = \"\") \n      year04 <- paste(year04, \"0217\", sep = \"\") \n      year03 <- paste(year03, \"0217\", sep = \"\") \n      year02 <- paste(year02, \"0217\", sep = \"\") \n      year01 <- paste(year01, \"0217\", sep = \"\")\n      year00 <- paste(year00, \"0217\", sep = \"\")\n\n      address <- \"http://api.nytimes.com/svc/search/v2/articlesearch.json?q=korea&begin_date=20150217&end_date=20160216&sort=newest&api-key=48c66fa2c448eda40826487d4f19a018%3A0%3A71658152\"\n      articleAddress <- \"http://api.nytimes.com/svc/search/v2/articlesearch.json?q=\"\n      \n      \n      articleKey <- \"&api-key=48c66fa2c448eda40826487d4f19a018:0:71658152\"\n      articleAPI10 <- paste(articleAddress, articleSearch,\"&begin_date=\",year09,\"&end_date=\",year10,\"&sort=newest\",articleKey, sep = \"\")\n      articleAPI09 <- paste(articleAddress, articleSearch,\"&begin_date=\",year08,\"&end_date=\",year09,\"&sort=newest\",articleKey, sep = \"\")\n      articleAPI08 <- paste(articleAddress, articleSearch,\"&begin_date=\",year07,\"&end_date=\",year08,\"&sort=newest\",articleKey, sep = \"\")\n      articleAPI07 <- paste(articleAddress, articleSearch,\"&begin_date=\",year06,\"&end_date=\",year07,\"&sort=newest\",articleKey, sep = \"\")\n      articleAPI06 <- paste(articleAddress, articleSearch,\"&begin_date=\",year05,\"&end_date=\",year06,\"&sort=newest\",articleKey, sep = \"\")\n      articleAPI05 <- paste(articleAddress, articleSearch,\"&begin_date=\",year04,\"&end_date=\",year05,\"&sort=newest\",articleKey, sep = \"\")\n      articleAPI04 <- paste(articleAddress, articleSearch,\"&begin_date=\",year03,\"&end_date=\",year04,\"&sort=newest\",articleKey, sep = \"\")\n      articleAPI03 <- paste(articleAddress, articleSearch,\"&begin_date=\",year02,\"&end_date=\",year03,\"&sort=newest\",articleKey, sep = \"\")\n      articleAPI02 <- paste(articleAddress, articleSearch,\"&begin_date=\",year01,\"&end_date=\",year02,\"&sort=newest\",articleKey, sep = \"\")\n      articleAPI01 <- paste(articleAddress, articleSearch,\"&begin_date=\",year00,\"&end_date=\",year01,\"&sort=newest\",articleKey, sep = \"\")\n      \n      #normalize \"about\n      aboutAPI10 <- paste(articleAddress, \"about\",\"&begin_date=\",year09,\"&end_date=\",year10,\"&sort=newest\",articleKey, sep = \"\")\n      aboutAPI09 <- paste(articleAddress, \"about\",\"&begin_date=\",year08,\"&end_date=\",year09,\"&sort=newest\",articleKey, sep = \"\")\n      aboutAPI08 <- paste(articleAddress, \"about\",\"&begin_date=\",year07,\"&end_date=\",year08,\"&sort=newest\",articleKey, sep = \"\")\n      aboutAPI07 <- paste(articleAddress, \"about\",\"&begin_date=\",year06,\"&end_date=\",year07,\"&sort=newest\",articleKey, sep = \"\")\n      aboutAPI06 <- paste(articleAddress, \"about\",\"&begin_date=\",year05,\"&end_date=\",year06,\"&sort=newest\",articleKey, sep = \"\")\n      aboutAPI05 <- paste(articleAddress, \"about\",\"&begin_date=\",year04,\"&end_date=\",year05,\"&sort=newest\",articleKey, sep = \"\")\n      aboutAPI04 <- paste(articleAddress, \"about\",\"&begin_date=\",year03,\"&end_date=\",year04,\"&sort=newest\",articleKey, sep = \"\")\n      aboutAPI03 <- paste(articleAddress, \"about\",\"&begin_date=\",year02,\"&end_date=\",year03,\"&sort=newest\",articleKey, sep = \"\")\n      aboutAPI02 <- paste(articleAddress, \"about\",\"&begin_date=\",year01,\"&end_date=\",year02,\"&sort=newest\",articleKey, sep = \"\")\n      aboutAPI01 <- paste(articleAddress, \"about\",\"&begin_date=\",year00,\"&end_date=\",year01,\"&sort=newest\",articleKey, sep = \"\")\n      \n      #artiConD\n      if (articleSearch == 'Enter search term' || articleSearch == \"\") {\n        message01 <- \"Please, Type your search term\"\n        message01\n      } else {\n        articleContent10 <- fromJSON(articleAPI10)\n        articleContent09 <- fromJSON(articleAPI09)\n        articleContent08 <- fromJSON(articleAPI08)\n        articleContent07 <- fromJSON(articleAPI07)\n        articleContent06 <- fromJSON(articleAPI06)\n        Sys.sleep(1)\n        articleContent05 <- fromJSON(articleAPI05)\n        articleContent04 <- fromJSON(articleAPI04)\n        articleContent03 <- fromJSON(articleAPI03)\n        articleContent02 <- fromJSON(articleAPI02)\n        articleContent01 <- fromJSON(articleAPI01)\n        \n        Sys.sleep(1)\n        #normalize \"About\"\n        normalContent10 <- fromJSON(aboutAPI10)\n        normalContent09 <- fromJSON(aboutAPI09)\n        normalContent08 <- fromJSON(aboutAPI08)\n        normalContent07 <- fromJSON(aboutAPI07)\n        normalContent06 <- fromJSON(aboutAPI06)\n        Sys.sleep(1)\n        normalContent05 <- fromJSON(aboutAPI05)\n        normalContent04 <- fromJSON(aboutAPI04)\n        normalContent03 <- fromJSON(aboutAPI03)\n        normalContent02 <- fromJSON(aboutAPI02)\n        normalContent01 <- fromJSON(aboutAPI01)\n        \n        artiConHit10 <- articleContent10$response$meta$hits\n        artiConHit09 <- articleContent09$response$meta$hits\n        artiConHit08 <- articleContent08$response$meta$hits\n        artiConHit07 <- articleContent07$response$meta$hits\n        artiConHit06 <- articleContent06$response$meta$hits\n        artiConHit05 <- articleContent05$response$meta$hits\n        artiConHit04 <- articleContent04$response$meta$hits\n        artiConHit03 <- articleContent03$response$meta$hits\n        artiConHit02 <- articleContent02$response$meta$hits\n        artiConHit01 <- articleContent01$response$meta$hits\n        \n        #normalize hit\n        normalConHit10 <- normalContent10$response$meta$hits\n        normalConHit09 <- normalContent09$response$meta$hits\n        normalConHit08 <- normalContent08$response$meta$hits\n        normalConHit07 <- normalContent07$response$meta$hits\n        normalConHit06 <- normalContent06$response$meta$hits\n        normalConHit05 <- normalContent05$response$meta$hits\n        normalConHit04 <- normalContent04$response$meta$hits\n        normalConHit03 <- normalContent03$response$meta$hits\n        normalConHit02 <- normalContent02$response$meta$hits\n        normalConHit01 <- normalContent01$response$meta$hits\n        \n        \n        hitVec <- c(artiConHit10, artiConHit09, artiConHit08, artiConHit07, artiConHit06, artiConHit05, artiConHit04, artiConHit03, artiConHit02, artiConHit01)\n        hitNormalVec <- c(normalConHit10,normalConHit09, normalConHit08, normalConHit07, normalConHit06, normalConHit05, normalConHit04, normalConHit03, normalConHit02, normalConHit01)\n        hitNormlizedVec <- hitVec / hitNormalVec\n        years <- c(year10, year09, year08, year07, year06, year05, year04, year03, year02, year01)\n        #Graph.Table\n        graphTable <- data.frame(years, hitVec, hitNormalVec, hitNormlizedVec)\n        \n\n        ### Graph\n        barHitGraph <- ggplot(graphTable, aes(x=years, y=hitVec)) + geom_bar(stat=\"identity\")\n        barNormLizedGraph <- ggplot(graphTable, aes(x=years, y=hitNormlizedVec)) + geom_bar(stat=\"identity\")\n        barJustAbout <- ggplot(graphTable, aes(x=years, y=hitNormalVec)) + geom_bar(stat=\"identity\")\n        \n        if (input$radio == 1) {\n          barHitGraph + theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 12),\n                           axis.text.y = element_text(size = 12),\n                           panel.background = element_blank())\n        } else if (input$radio == 2) {\n          barNormLizedGraph + theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 12),\n                                   axis.text.y = element_text(size = 12),\n                                   panel.background = element_blank())\n        } else if (input$radio == 3) {\n          barJustAbout + theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 12),\n                                 axis.text.y = element_text(size = 12),\n                                 panel.background = element_blank())\n        } \n        \n      }\n    }) # End of Isolate\n\n    \n  }) #Graph Hit\n  \n  output$graphMonth <- renderPlot({\n    input$yearMonthButton\n    isolate({\n        articleSearch <- articleSearch()\n        if (articleSearch != \"\") {\n                yearMonth <- yearMonth()\n                \n                month12End <- paste(yearMonth, \"1231\", sep = \"\")\n                month12 <- paste(yearMonth, \"1201\", sep = \"\")\n                month11 <- paste(yearMonth, \"1101\", sep = \"\")\n                month10 <- paste(yearMonth, \"1001\", sep = \"\")\n                month09 <- paste(yearMonth, \"0901\", sep = \"\")\n                month08 <- paste(yearMonth, \"0801\", sep = \"\")\n                month07 <- paste(yearMonth, \"0701\", sep = \"\")\n                month06 <- paste(yearMonth, \"0601\", sep = \"\")\n                month05 <- paste(yearMonth, \"0501\", sep = \"\")\n                month04 <- paste(yearMonth, \"0401\", sep = \"\")\n                month03 <- paste(yearMonth, \"0301\", sep = \"\")\n                month02 <- paste(yearMonth, \"0201\", sep = \"\")\n                month01 <- paste(yearMonth, \"0101\", sep = \"\")\n                \n                articleAddress <- \"http://api.nytimes.com/svc/search/v2/articlesearch.json?q=\"\n                \n                articleKey <- \"&api-key=48c66fa2c448eda40826487d4f19a018:0:71658152\"\n                hitMon12 <- paste(articleAddress, articleSearch,\"&begin_date=\",month12,\"&end_date=\",month12End,articleKey, sep = \"\")\n                hitMon11 <- paste(articleAddress, articleSearch,\"&begin_date=\",month11,\"&end_date=\",month12,articleKey, sep = \"\")\n                hitMon10 <- paste(articleAddress, articleSearch,\"&begin_date=\",month10,\"&end_date=\",month11,articleKey, sep = \"\")\n                hitMon09 <- paste(articleAddress, articleSearch,\"&begin_date=\",month09,\"&end_date=\",month10,articleKey, sep = \"\")\n                hitMon08 <- paste(articleAddress, articleSearch,\"&begin_date=\",month08,\"&end_date=\",month09,articleKey, sep = \"\")\n                hitMon07 <- paste(articleAddress, articleSearch,\"&begin_date=\",month07,\"&end_date=\",month08,articleKey, sep = \"\")\n                hitMon06 <- paste(articleAddress, articleSearch,\"&begin_date=\",month06,\"&end_date=\",month07,articleKey, sep = \"\")\n                hitMon05 <- paste(articleAddress, articleSearch,\"&begin_date=\",month05,\"&end_date=\",month06,articleKey, sep = \"\")\n                hitMon04 <- paste(articleAddress, articleSearch,\"&begin_date=\",month04,\"&end_date=\",month05,articleKey, sep = \"\")\n                hitMon03 <- paste(articleAddress, articleSearch,\"&begin_date=\",month03,\"&end_date=\",month04,articleKey, sep = \"\")\n                hitMon02 <- paste(articleAddress, articleSearch,\"&begin_date=\",month02,\"&end_date=\",month03,articleKey, sep = \"\")\n                hitMon01 <- paste(articleAddress, articleSearch,\"&begin_date=\",month01,\"&end_date=\",month02,articleKey, sep = \"\")\n                \n                articleMonth12 <- fromJSON(hitMon12)\n                articleMonth11 <- fromJSON(hitMon11)\n                articleMonth10 <- fromJSON(hitMon10)\n                Sys.sleep(0.5)\n                articleMonth09 <- fromJSON(hitMon09)\n                articleMonth08 <- fromJSON(hitMon08)\n                articleMonth07 <- fromJSON(hitMon07)\n                Sys.sleep(1.1)\n                articleMonth06 <- fromJSON(hitMon06)\n                articleMonth05 <- fromJSON(hitMon05)\n                articleMonth04 <- fromJSON(hitMon04)\n                Sys.sleep(0.5)\n                articleMonth03 <- fromJSON(hitMon03)\n                articleMonth02 <- fromJSON(hitMon02)\n                articleMonth01 <- fromJSON(hitMon01)\n                \n                hitMonVec <- c( articleMonth12$response$meta$hits, articleMonth11$response$meta$hits, articleMonth10$response$meta$hits,\n                      articleMonth09$response$meta$hits, articleMonth08$response$meta$hits, articleMonth07$response$meta$hits, articleMonth06$response$meta$hits,\n                      articleMonth05$response$meta$hits, articleMonth04$response$meta$hits, articleMonth03$response$meta$hits, articleMonth02$response$meta$hits,\n                      articleMonth01$response$meta$hits)\n                \n                monthVec <- c(month12, month11, month10, month09, month08, month07, month06, month05, month04, month03,\n                              month02, month01)\n                graphMonthTable <- data.frame(monthVec, hitMonVec)\n                \n                barMonthGraph <- ggplot(graphMonthTable, aes(x=monthVec, y=hitMonVec)) + geom_bar(stat=\"identity\")\n                barMonthGraph + theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 12),\n                                      axis.text.y = element_text(size = 12),\n                                      panel.background = element_blank())\n        } # End of articleSearch != 0\n    })#end of isolate\n  })#End of graphMonth\n  \n  output$articleExam <- DT::renderDataTable({\n    input$goArticle\n    isolate({\n      articleSearch <- articleSearch()\n      yearInterest <- yearInterest()\n      yearInterest01 <- yearInterest - 1\n      monthInterest <- monthInterest()\n      pageInput <- pageInput()\n      pageInput <- paste(\"&page=\", pageInput, sep = \"\")\n      \n      yearForMonth <- yearInterest\n      yearInterest01 <- paste(yearInterest01, \"0217\", sep = \"\") \n      yearInterest <- paste(yearInterest, \"0217\", sep = \"\")\n\n      \n      articleAddress <- \"http://api.nytimes.com/svc/search/v2/articlesearch.json?q=\"\n      \n      articleKey <- \"&api-key=48c66fa2c448eda40826487d4f19a018:0:71658152\"\n      articleAPI10 <- paste(articleAddress, articleSearch,\"&begin_date=\",yearInterest01,\"&end_date=\",yearInterest,pageInput,articleKey, sep = \"\")\n      \n      if (articleSearch != \"\") {\n                \n                articleContent10 <- fromJSON(articleAPI10)\n                \n                artiConDoc10 <- articleContent10$response$docs\n                \n                artiURL10 <- artiConDoc10$web_url\n                artiConSnippet10 <- artiConDoc10$snippet\n                \n                table10 <- data.frame(artiConSnippet10, artiURL10)\n                \n                #Articlae Table\n                if (input$radioMonth == 1 ) {\n                  table10\n                } else if (input$radioMonth == 2) {\n                    if (monthInterest <= 9) {\n                      monthInterest <- paste(\"0\", monthInterest, sep = \"\")\n                    } else if (monthInterest >10) {\n                      monthInterest <- as.character(monthInterest)\n                    } \n                  \n                    beginMon <- paste(yearForMonth, monthInterest, \"01\", sep = \"\" )\n                    endMon <- paste(yearForMonth, monthInterest, \"30\", sep = \"\")\n                    articleMonthAPI <- paste(articleAddress, articleSearch,\"&begin_date=\",beginMon,\"&end_date=\",endMon,articleKey, sep = \"\")\n                    monthContent <- fromJSON(articleMonthAPI)\n                    monConDoc <- monthContent$response$docs\n                    \n                    \n                    #your_link <- monConDoc$web_url\n                    #your_link <- paste0(\"<a href='\",your_link,\"' target='_blank'>link</a>\")\n                    #monURL <- your_link\n                    monSnippet <- monConDoc$snippet\n                    tableMonth <- data.frame(monSnippet, monConDoc$web_url)\n                    tableMonth\n                }\n      }# end of if articleSearch != \"\"\n    }) # End of isolate\n    \n  }\n  , options = list(columnDefs = list(list(\n    targets = 2,\n    render = JS(\n      \"function(data, type, row, meta) {\",\n      \"return type === 'display' && data.length > 6 ?\",\n      \"'<span title=\\\"' + data + '\\\">' + data.substr(0, 20) + '...</span>' : data;\",\n      \"}\")\n  )))\n  )\n  \n  output$rawAPI <- renderPrint({\n    articleSearch <- articleSearch()\n      if (articleSearch != \"\") {\n            yearInterest <- yearInterest()\n            yearInterest01 <- yearInterest - 1\n            \n            yearInterest <- paste(yearInterest, \"0217\", sep = \"\") \n            yearInterest01 <- paste(yearInterest01, \"0217\", sep = \"\") \n            \n            articleAddress <- \"http://api.nytimes.com/svc/search/v2/articlesearch.json?q=\"\n            \n            articleKey <- \"&api-key=48c66fa2c448eda40826487d4f19a018:0:71658152\"\n            articleAPI10 <- paste(articleAddress, articleSearch,\"&begin_date=\",yearInterest01,\"&end_date=\",yearInterest,\"&sort=newest\",articleKey, sep = \"\")\n            \n            articleContent10 <- fromJSON(articleAPI10)\n            infoRawAPI <- c(yearInterest, articleSearch, articleContent10)\n            infoRawAPI\n      } #End of articleSearch\n  })\n\n  output$test02 <- renderPrint({\n    fsAddress <- \"https://api.foursquare.com/v2/venues/search?ll=40.7,-74&oauth_token=MJOLVR2X02FDQXFHENNZPHSBG12RUT5MHKEKSE2LKIYGAWX4&v=20160215\"\n    fsResult <- fromJSON(fsAddress)\n    fsResult\n  })\n  \n  output$test03 <- renderPrint({\n    apiData <- fromJSON('/Volumes/64GB/NYC/project03/api2012.txt')\n    apiResu <- apiData$results\n    apiResu\n  })  \n  \n  output$codeText <- renderText({\n    aa <- scan(file =\"ui.R\", what = \"character\", sep=\":\")\n    bb <- paste(aa, collapse = \"\\n \")\n    aaa <- \"http://shiny.rstudio.com/articles/html-tags.html\"\n    aa \n  })\n  \n  output$table <- DT::renderDataTable({\n    DT::datatable(cars)\n  })\n  \n  output$textGeo <- renderDataTable({\n    input$goLonLat\n    isolate({\n      addressInput <- addressInput()\n      #https://maps.googleapis.com/maps/api/geocode/json?address=4620%20parsons%20blvd%20flushing%20ny%20%20key=AIzaSyANifkybPlJWYynG_FSwzwSn-CunJTE4N0\n      if (addressInput != \"\") {\n        #geoWeb <- paste(\"https://maps.googleapis.com/maps/api/geocode/json?address=\", addressInput, \"&key=AIzaSyANifkybPlJWYynG_FSwzwSn-CunJTE4N0\", sep = \"\")\n        #geoAPI <- fromJSON(geoWeb)\n        #latAPI <- geoAPI$results$geometry$location$lat\n        #lntAPI <- geoAPI$results$geometry$location$lnt\n        #location <- c(latAPI, lntAPI)\n        #addressInput\n        jobsAdd <- paste(\"https://api.usa.gov/jobs/search.json?query=\", addressInput, sep = \"\")\n        jobsAPI <- fromJSON(jobsAdd)\n        \n        Sys.sleep(1)\n        \n        addressVec <- unlist(jobsAPI$locations)\n        lonlatVec <-c()\n        latt <- c()\n        lont <- c()\n        \n        i = 1\n        while (i <= length(addressVec)) {\n          address = as.character(addressVec[i])\n          address = gsub(\" \", \"\", address)\n          geoWeb <- paste(\"https://maps.googleapis.com/maps/api/geocode/json?address=\", address, \"&key=AIzaSyANifkybPlJWYynG_FSwzwSn-CunJTE4N0\", sep = \"\")\n          geoAPI <- fromJSON(geoWeb)\n          latt[i] <- geoAPI$results$geometry$location$lat\n          lont[i] <- geoAPI$results$geometry$location$lng\n          Sys.sleep(0.2)\n          i = i + 1\n        }\n        jobsAPI$locations <- unlist(jobsAPI$locations)\n        \n        Title <- jobsAPI$position_title\n        MinWage <- jobsAPI$minimum\n        MaxWage <- jobsAPI$maximum\n        Organization <- jobsAPI$organization_name\n        \n        Locations <- as.character(jobsAPI$locations)\n        #Locations <- unique(Locations)\n        jobTable <- data.frame(Title, Organization, MinWage, MaxWage, Locations,latt, lont)\n        jobTable\n        \n      }# end of if \n\n      \n    })# end of isolate\n    \n  })# end of output$textGeo\n})\n",
    "created" : 1456252880613.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1098279512",
    "id" : "5E3BB743",
    "lastKnownWriteTime" : 1456342650,
    "path" : "/Volumes/64GB/NYC/project03/prac05/server.R",
    "project_path" : "server.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}